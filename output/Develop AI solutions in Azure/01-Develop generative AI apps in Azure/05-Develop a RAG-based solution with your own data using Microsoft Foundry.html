<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Develop a RAG-based solution with your own data using Microsoft Foundry</title>
    <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; line-height: 1.6; }
    h1 { color: #0078d4; border-bottom: 2px solid #0078d4; padding-bottom: 10px; }
    h2 { color: #333; margin-top: 40px; border-bottom: 1px solid #ddd; padding-bottom: 8px; }
    .section { margin-bottom: 40px; }
    .section-header { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    .section-header a { color: #0078d4; text-decoration: none; }
    .section-header a:hover { text-decoration: underline; }
    img { max-width: 100%; height: auto; }
    pre { background: #f4f4f4; padding: 15px; overflow-x: auto; border-radius: 5px; }
    code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f5f5f5; }
    .NOTE, .TIP { padding: 12px 15px; margin: 15px 0; border-radius: 5px; border-left: 4px solid; }
    .NOTE { background-color: #e7f3ff; border-color: #0078d4; }
    .NOTE > p:first-child { font-weight: bold; color: #0078d4; margin-top: 0; }
    .TIP { background-color: #e8f5e9; border-color: #4caf50; }
    .TIP > p:first-child { font-weight: bold; color: #2e7d32; margin-top: 0; }
</style>
</head>
<body>
    <h1>Develop a RAG-based solution with your own data using Microsoft Foundry</h1>

    <div class="section">
        <div class="section-header">
            <h2>1. Introduction</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/1-introduction">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/1-introduction</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Introduction</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.introduction">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">2 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>Language models are growing in popularity as they create impressive coherent answers to a user’s questions. Especially when a user interacts with a language model through chat, it provides an intuitive way to get the information they need.</p>
<p>One prevalent challenge when implementing language models through chat is the so-called <strong>groundedness</strong>, which refers to whether a response is rooted, connected, or anchored in reality or a specific context. In other words, groundedness refers to whether the response of a language model is based on factual information.</p>
<h2 id="ungrounded-prompts-and-responses">Ungrounded prompts and responses</h2>
<p>When you use a language model to generate a response to a prompt, the only information that the model has to base the answer on comes from the data on which it was trained - which is often just a large volume of uncontextualized text from the Internet or some other source.</p>
<p><img alt="Diagram of an ungrounded model returning an uncontextualized response." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/ungrounded.png"/></p>
<p>The result will likely be a grammatically coherent and logical response to the prompt, but because it isn't grounded in relevant, factual data, it's uncontextualized; and may in fact be inaccurate and include "invented" information. For example, the question "Which product should I use to do <em>X</em>?" might include details of a fictional product.</p>
<h2 id="grounded-prompts-and-responses">Grounded prompts and responses</h2>
<p>In contrast, you can use a data source to <em>ground</em> the prompt with some relevant, factual context. The prompt can then be submitted to a language model, including the grounding data, to generate a contextualized, relevant, and accurate response.</p>
<p><img alt="Diagram of a grounded model returning a contextualized response." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/grounded.png"/></p>
<p>The data source can be any repository of relevant data. For example, you could use data from a product catalog database to ground the prompt "Which product should I use to do <em>X</em>?" so that the response includes relevant details of products that exist in the catalog.</p>
<p>In this module, you explore how to create your own chat-based language model application that is grounded, by building an agent with your own data.</p>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>2. Understand how to ground your language model</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/2-ground-language-model">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/2-ground-language-model</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Understand how to ground your language model</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.ground-language-model">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">6 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>Language models excel in generating engaging text, and are ideal as the base for agents. Agents provide users with an intuitive chat-based application to receive assistance in their work. When designing an agent for a specific use case, you want to ensure your language model is grounded and uses factual information that is relevant to what the user needs.</p>
<p>Though language models are trained on a vast amount of data, they may not have access to the knowledge you want to make available to your users. To ensure that an agent is grounded on specific data to provide accurate and domain-specific responses, you can use <strong>Retrieval Augmented Generation</strong> (<strong>RAG</strong>).</p>
<h2 id="understanding-rag">Understanding RAG</h2>
<p>RAG is a technique that you can use to ground a language model. In other words, it's a process for retrieving information that is relevant to the user's initial prompt. In general terms, the RAG pattern incorporates the following steps:</p>
<p><img alt="Diagram of the retrieval augmented generation pattern." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/rag-pattern.png"/></p>
<ol>
<li><strong>Retrieve</strong> grounding data based on the initial user-entered prompt.</li>
<li><strong>Augment</strong> the prompt with grounding data.</li>
<li>Use a language model to <strong>generate</strong> a grounded response.</li>
</ol>
<p>By retrieving context from a specified data source, you ensure that the language model uses relevant information when responding, instead of relying on its training data.</p>
<p>Using RAG is a powerful and easy-to-use technique for many cases in which you want to ground your language model and improve the factual accuracy of your generative AI app's responses.</p>
<h2 id="adding-grounding-data-to-an-azure-ai-project">Adding grounding data to an Azure AI project</h2>
<p>You can use Microsoft Foundry to build a custom agent that uses your own data to ground prompts. Microsoft Foundry supports a range of data connections that you can use to add data to a project, including:</p>
<ul>
<li>Azure Blob Storage</li>
<li>Azure Data Lake Storage Gen2</li>
<li>Microsoft OneLake</li>
</ul>
<p>You can also upload files or folders to the storage used by your AI Foundry project.</p>
<p><img alt="Screenshot of the Add Data dialog in Microsoft Foundry portal." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/add-data.png"/></p>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>3. Make your data searchable</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/3-search-data">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/3-search-data</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Make your data searchable</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.search-data">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">7 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>When you want to create an agent that uses your own data to generate accurate answers, you need to be able to search your data efficiently. When you build an agent with the Microsoft Foundry, you can use the integration with <strong>Azure AI Search</strong> to retrieve the relevant context in your chat flow.</p>
<p>Azure AI Search is a <strong>retriever</strong> that you can include when building a language model application with prompt flow. Azure AI Search allows you to bring your own data, index your data, and query the index to retrieve any information you need.</p>
<p><img alt="Diagram showing an index being queried to retrieve grounding data." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/index.png"/></p>
<h2 id="using-a-vector-index">Using a <em>vector</em> index</h2>
<p>While a text-based index will improve search efficiency, you can usually achieve a better data retrieval solution by using a <em>vector</em>-based index that contains <em>embeddings</em> that represent the text tokens in your data source.</p>
<p>An embedding is a special format of data representation that a search engine can use to easily find the relevant information. More specifically, an embedding is a vector of floating-point numbers.</p>
<p>For example, imagine you have two documents with the following contents:</p>
<ul>
<li><em>"The children played joyfully in the park."</em></li>
<li><em>"Kids happily ran around the playground."</em></li>
</ul>
<p>These two documents contain texts that are semantically related, even though different words are used. By creating vector embeddings for the text in the documents, the relation between the words in the text can be mathematically calculated.</p>
<p>Imagine the keywords being extracted from the document and plotted as a vector in a multidimensional space:</p>
<p><span class="mx-imgBorder">
<img alt="Diagram of vector embeddings." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/vector-embeddings.jpg"/>
</span>
</p>
<p>The distance between vectors can be calculated by measuring the cosine of the angle between two vectors, also known as the <em>cosine similarity</em>. In other words, the cosine similarity computes the semantic similarity between documents and a query.</p>
<p>By representing words and their meanings with vectors, you can extract relevant context from your data source even when your data is stored in different formats (text or image) and languages.</p>
<p>When you want to be able to use vector search to search your data, you need to create embeddings when creating your search index. To create embeddings for your search index, you can use an Azure OpenAI embedding model available in Microsoft Foundry.</p>
<p><img alt="Diagram showing a vector index that contains embeddings." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/vector-index.png"/></p>
<div class="TIP">
<p>Tip</p>
<p>Learn more about <a data-linktype="absolute-path" href="/en-us/azure/ai-services/openai/concepts/understand-embeddings?azure-portal=true">embeddings in the Azure OpenAI in Foundry Models</a>.</p>
</div>
<h2 id="creating-a-search-index">Creating a search index</h2>
<p>In Azure AI Search, a <strong>search index</strong> describes how your content is organized to make it searchable. Imagine a library containing many books. You want to be able to search through the library and retrieve the relevant book easily and efficiently. To make the library searchable, you create a catalog that contains any relevant data about books to make any book easy to find. A library’s catalog serves as the search index.</p>
<p>Though there are different approaches to creating an index, the integration of Azure AI Search in Microsoft Foundry makes it easy for you to create an index that is suitable for language models. You can add your data to Microsoft Foundry, after which you can use Azure AI Search to create an index in the Microsoft Foundry portal using an embedding model. The index asset is stored in Azure AI Search and queried by Microsoft Foundry when used in a chat flow.</p>
<p><span class="mx-imgBorder">
<img alt="Screenshot of creating an index in Microsoft Foundry." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/create-index.png"/>
</span>
</p>
<p>How you configure your search index depends on the data you have and the context you want your language model to use. For example, <strong>keyword search</strong> enables you to retrieve information that exactly matches the search query. <strong>Semantic search</strong> already takes it one step further by retrieving information that matches the meaning of the query instead of the exact keyword, using semantic models. Currently, the most advanced technique is <strong>vector search</strong>, which creates embeddings to represent your data.</p>
<div class="TIP">
<p>Tip</p>
<p>Learn more about <a data-linktype="absolute-path" href="/en-us/azure/search/vector-search-overview?azure-portal=true">vector search</a>.</p>
</div>
<h2 id="searching-an-index">Searching an index</h2>
<p>There are several ways that information can be queried in an index:</p>
<ul>
<li><strong>Keyword search</strong>: Identifies relevant documents or passages based on specific keywords or terms provided as input.</li>
<li><strong>Semantic search</strong>: Retrieves documents or passages by understanding the meaning of the query and matching it with semantically related content rather than relying solely on exact keyword matches.</li>
<li><strong>Vector search</strong>: Uses mathematical representations of text (vectors) to find similar documents or passages based on their semantic meaning or context.</li>
<li><strong>Hybrid search</strong>: Combines any or all of the other search techniques. Queries are executed in parallel and are returned in a unified result set.</li>
</ul>
<p>When you create a search index in Microsoft Foundry, you're guided to configuring an index that is most suitable to use in combination with a language model. When your search results are used in a generative AI application, hybrid search gives the most accurate results.</p>
<p>Hybrid search is a combination of keyword (and full text), and vector search, to which semantic ranking is optionally added. When you create an index that is compatible with hybrid search, the retrieved information is precise when exact matches are available (using keywords), and still relevant when only conceptually similar information can be found (using vector search).</p>
<div class="TIP">
<p>Tip</p>
<p>Learn more about <a data-linktype="absolute-path" href="/en-us/azure/search/hybrid-search-overview?azure-portal=true">hybrid search</a>.</p>
</div>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>4. Create a RAG-based client application</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/3b-openai-client">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/3b-openai-client</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Create a RAG-based client application</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.openai-client">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">7 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>When you've created an Azure AI Search index for your contextual data, you can use it with an OpenAI model. To ground prompts with data from your index, the Azure OpenAI SDK supports extending the request with connection details for the index.</p>
<p>The following Python code example shows how to implement this pattern.</p>
<pre><code class="lang-python">from openai import AzureOpenAI

# Get an Azure OpenAI chat client
chat_client = AzureOpenAI(
    api_version = "2024-12-01-preview",
    azure_endpoint = open_ai_endpoint,
    api_key = open_ai_key
)

# Initialize prompt with system message
prompt = [
    {"role": "system", "content": "You are a helpful AI assistant."}
]

# Add a user input message to the prompt
input_text = input("Enter a question: ")
prompt.append({"role": "user", "content": input_text})

# Additional parameters to apply RAG pattern using the AI Search index
rag_params = {
    "data_sources": [
        {
            "type": "azure_search",
            "parameters": {
                "endpoint": search_url,
                "index_name": "index_name",
                "authentication": {
                    "type": "api_key",
                    "key": search_key,
                }
            }
        }
    ],
}

# Submit the prompt with the index information
response = chat_client.chat.completions.create(
    model="&lt;model_deployment_name&gt;",
    messages=prompt,
    extra_body=rag_params
)

# Print the contextualized response
completion = response.choices[0].message.content
print(completion)
</code></pre>
<p>In this example, the search against the index is <em>keyword-based</em> - in other words, the query consists of the text in the user prompt, which is matched to text in the indexed documents. When using an index that supports it, an alternative approach is to use a <em>vector-based</em> query in which the index and the query use numeric vectors to represent text tokens. Searching with vectors enables matching based on semantic similarity as well as literal text matches.</p>
<p>To use a vector-based query, you can modify the specification of the Azure AI Search data source details to include an embedding model; which is then used to vectorize the query text.</p>
<pre><code class="lang-python">rag_params = {
    "data_sources": [
        {
            "type": "azure_search",
            "parameters": {
                "endpoint": search_url,
                "index_name": "index_name",
                "authentication": {
                    "type": "api_key",
                    "key": search_key,
                },
                # Params for vector-based query
                "query_type": "vector",
                "embedding_dependency": {
                    "type": "deployment_name",
                    "deployment_name": "&lt;embedding_model_deployment_name&gt;",
                },
            }
        }
    ],
}
</code></pre>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>5. Implement RAG in a prompt flow</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/4-build-copilot">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/4-build-copilot</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Implement RAG in a prompt flow</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.build-copilot">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">7 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>After uploading data to Microsoft Foundry and creating an index on your data using the integration with Azure AI Search, you can implement the RAG pattern with <em>Prompt Flow</em> to build a generative AI application.</p>
<p><strong>Prompt Flow</strong> is a development framework for defining flows that orchestrate interactions with an LLM.</p>
<p><img alt="Diagram of a prompt flow." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/prompt-flow.png"/></p>
<p>A flow begins with one or more <em>inputs</em>, usually a question or prompt entered by a user, and in the case of iterative conversations the chat history to this point.</p>
<p>The flow is then defined as a series of connected <em>tools</em>, each of which performs a specific operation on the inputs and other environmental variables. There are multiple types of tool that you can include in a prompt flow to perform tasks such as:</p>
<ul>
<li>Running custom Python code</li>
<li>Looking up data values in an index</li>
<li>Creating prompt variants - enabling you to define multiple versions of a prompt for a large language model (LLM), varying system messages or prompt wording, and compare and evaluate the results from each variant.</li>
<li>Submitting a prompt to an LLM to generate results.</li>
</ul>
<p>Finally, the flow has one or more <em>outputs</em>, typically to return the generated results from an LLM.</p>
<h2 id="using-the-rag-pattern-in-a-prompt-flow">Using the RAG pattern in a prompt flow</h2>
<p>The key to using the RAG pattern in a prompt flow is to use an Index Lookup tool to retrieve data from an index so that subsequent tools in the flow can use the results to augment the prompt used to generate output from an LLM.</p>
<p><img alt="Diagram of a prompt flow with an Index Lookup tool." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/rag-prompt-flow.png"/></p>
<h2 id="use-a-sample-to-create-a-chat-flow">Use a sample to create a chat flow</h2>
<p>Prompt flow provides various samples you can use as a starting point to create an application. When you want to combine RAG and a language model in your application, you can clone the <strong>Multi-round Q&amp;A on your data</strong> sample.</p>
<p>The sample contains the necessary elements to include RAG and a language model:</p>
<p><span class="mx-imgBorder">
<img alt="Screenshot of the chat flow created with the Q&amp;A sample." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/chat-flow.png"/>
</span>
</p>
<ol>
<li>Append the history to the chat input to define a prompt in the form of a contextualized form of a question.</li>
<li>Look up relevant information from your data using your search index.</li>
<li>Generate the prompt context by using the retrieved data from the index to augment the question.</li>
<li>Create prompt variants by adding a system message and structuring the chat history.</li>
<li>Submit the prompt to a language model that generates a natural language response.</li>
</ol>
<p>Let's explore each of these elements in more detail.</p>
<h3 id="modify-query-with-history">Modify query with history</h3>
<p>The first step in the flow is a Large Language Model (LLM) node that takes the chat history and the user's last question and generates a new question that includes all necessary information. By doing so, you generate more succinct input that is processed by the rest of the flow.</p>
<h3 id="look-up-relevant-information">Look up relevant information</h3>
<p>Next, you use the Index Lookup tool to query the search index you created with the integrated Azure AI Search feature and find the relevant information from your data source.</p>
<div class="TIP">
<p>Tip</p>
<p>Learn more about the <a data-linktype="absolute-path" href="/en-us/azure/machine-learning/prompt-flow/tools-reference/index-lookup-tool?azure-portal=true">Index Lookup tool</a>.</p>
</div>
<h3 id="generate-prompt-context">Generate prompt context</h3>
<p>The output of the Index Lookup tool is the retrieved context you want to use when generating a response to the user. You want to use the output in a prompt that is sent to a language model, which means you want to parse the output into a more suitable format.</p>
<p>The output of the Index Lookup tool can include the top <em>n</em> results (depending on the parameters you set). When you generate the prompt context, you can use a Python node to iterate over the retrieved documents from your data source and combine their contents and sources into one document string. The string will be used in the prompt you send to the language model in the next step of the flow.</p>
<h3 id="define-prompt-variants">Define prompt variants</h3>
<p>When you construct the prompt you want to send to your language model, you can use variants to represent different prompt contents.</p>
<p>When including RAG in your chat flow, your goal is to ground the chatbot's responses. Next to retrieving relevant context from your data source, you can also influence the groundedness of the chatbot's response by instructing it to use the context and aim to be factual.</p>
<p>With the prompt variants, you can provide varying system messages in the prompt to explore which content provides the most groundedness.</p>
<h3 id="chat-with-context">Chat with context</h3>
<p>Finally, you use an LLM node to send the prompt to a language model to generate a response using the relevant context retrieved from your data source. The response from this node is also the output of the entire flow.</p>
<p>After configuring the sample chat flow to use your indexed data and the language model of your choosing, you can deploy the flow and integrate it with an application to offer users an agentic experience.</p>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>6. Exercise - Create a generative AI app that uses your own data</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/5-exercise">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/5-exercise</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Exercise - Create a generative AI app that uses your own data</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.exercise">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">45 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>If you have an Azure subscription, you can use Microsoft Foundry to create a RAG-based agent for yourself.</p>
<div class="NOTE">
<p>Note</p>
<p>If you don't have an Azure subscription, and you want to explore Microsoft Foundry, you can <a data-linktype="external" href="https://azure.microsoft.com/pricing/purchase-options/azure-account?cid=msft_learn">sign up for an account</a>, which includes credits for the first 30 days.</p>
</div>
<p>Launch the exercise and follow the instructions.</p>
<p><a data-linktype="external" href="https://go.microsoft.com/fwlink/?linkid=2261362&amp;azure-portal=true"><img alt="Button to launch exercise." data-linktype="relative-path" src="https://learn.microsoft.com/en-us/training/wwl-data-ai/build-copilot-ai-studio/media/launch-exercise.png"/></a></p>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>7. Module assessment</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/6-knowledge-check">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/6-knowledge-check</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Module assessment</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.knowledge-check">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">3 minutes</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div aria-hidden="true" hidden="" id="module-unit-content">
</div>
<form aria-hidden="true" aria-label="Knowledge check" class="quiz-form margin-top-xs" data-bi-name="quiz" hidden="" id="question-container" role="form">
<fieldset class="field">
<div role="list">
<div class="quiz-question" data-bi-name="question" role="listitem">
<div aria-labelledby="quiz-question-1" class="quiz-question-title font-size-md margin-top-sm margin-bottom-xs" role="radiogroup">
<div class="margin-top-sm margin-bottom-xs field-label" id="quiz-question-1">
<span class="font-weight-semibold">1.</span>
<p>What does groundedness refer to in the context of generative AI?</p>
<span class="required-indicator"></span>
</div>
<div class="field-body">
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-0-0">
<input class="radio-dot choice-input" id="quiz-choice-0-0" name="0" type="radio" value="0"/>
<div class="margin-inline-sm radio-label-text">
<p>The use of a locally deployed language model.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-0-1">
<input class="radio-dot choice-input" id="quiz-choice-0-1" name="0" type="radio" value="1"/>
<div class="margin-inline-sm radio-label-text">
<p>Using data to contextualize prompts and ensure relevant responses.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-0-2">
<input class="radio-dot choice-input" id="quiz-choice-0-2" name="0" type="radio" value="2"/>
<div class="margin-inline-sm radio-label-text">
<p>Using the lowest possible number of tokens in a prompt.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
</div>
</div>
</div>
<div class="quiz-question" data-bi-name="question" role="listitem">
<div aria-labelledby="quiz-question-2" class="quiz-question-title font-size-md margin-top-sm margin-bottom-xs" role="radiogroup">
<div class="margin-top-sm margin-bottom-xs field-label" id="quiz-question-2">
<span class="font-weight-semibold">2.</span>
<p>What pattern can you use to ground prompts?</p>
<span class="required-indicator"></span>
</div>
<div class="field-body">
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-1-0">
<input class="radio-dot choice-input" id="quiz-choice-1-0" name="1" type="radio" value="0"/>
<div class="margin-inline-sm radio-label-text">
<p>Metadata Optimized Prompt (MOP).</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-1-1">
<input class="radio-dot choice-input" id="quiz-choice-1-1" name="1" type="radio" value="1"/>
<div class="margin-inline-sm radio-label-text">
<p>Data Understanding Support Text (DUST).</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-1-2">
<input class="radio-dot choice-input" id="quiz-choice-1-2" name="1" type="radio" value="2"/>
<div class="margin-inline-sm radio-label-text">
<p>Retrieval Augmented Generation (RAG).</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
</div>
</div>
</div>
<div class="quiz-question" data-bi-name="question" role="listitem">
<div aria-labelledby="quiz-question-3" class="quiz-question-title font-size-md margin-top-sm margin-bottom-xs" role="radiogroup">
<div class="margin-top-sm margin-bottom-xs field-label" id="quiz-question-3">
<span class="font-weight-semibold">3.</span>
<p>How can you use the RAG pattern in a client app that uses the Azure OpenAI SDK?</p>
<span class="required-indicator"></span>
</div>
<div class="field-body">
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-2-0">
<input class="radio-dot choice-input" id="quiz-choice-2-0" name="2" type="radio" value="0"/>
<div class="margin-inline-sm radio-label-text">
<p>Add text files containing the grounding data to the app folder.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-2-1">
<input class="radio-dot choice-input" id="quiz-choice-2-1" name="2" type="radio" value="1"/>
<div class="margin-inline-sm radio-label-text">
<p>You don't need to do anything. Microsoft Foundry automatically grounds all prompts using Bing Search.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
<label class="quiz-choice display-flex padding-block-xxs padding-inline-xs margin-bottom-xxs radio" for="quiz-choice-2-2">
<input class="radio-dot choice-input" id="quiz-choice-2-2" name="2" type="radio" value="2"/>
<div class="margin-inline-sm radio-label-text">
<p>Add index connection details to the OpenAI ChatClient configuration.</p>
</div>
<div ariahidden="true" class="font-weight-semibold position-absolute right-0 margin-right-md answer-result-indicator" hidden="">
<span class="icon"></span>
<span class="answer-result-text"></span>
</div>
</label>
<div class="quiz-choice-explanation margin-block-xxs font-weight-semibold margin-left-lg">
</div>
</div>
</div>
</div>
</div>
<div class="has-loading-skeleton" id="module-unit-quiz-submit-container"></div>
<p class="font-size-sm color-danger font-weight-semibold margin-top-xxs is-hidden" id="unanswered-question-error" role="alert">You must answer all questions before checking your work.</p>
<p class="visually-hidden" id="screen-reader-text"></p>
</fieldset>
</form>
<form aria-hidden="true" aria-label="Knowledge check" class="margin-top-xs" data-bi-name="module-assessment" hidden="" id="module-assessment-questions-form" role="form">
<fieldset class="field">
<div id="module-assessment-questions-container" role="list"></div>
<div aria-hidden="true" hidden="" id="module-assessment-objectives-container" role="list"></div>
<div id="module-assessment-submit-container"></div>
<p class="font-size-sm color-danger font-weight-semibold margin-top-xxs is-hidden" id="unanswered-module-assessment-question-error" role="alert">You must answer all questions before checking your work.</p>
</fieldset>
</form>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>8. Summary</h2>
            <a href="https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/7-summary">https://learn.microsoft.com/en-us/training/modules/build-copilot-ai-studio/7-summary</a>
        </div>
        <div class="content"><main class="layout-body-main has-body-background-dark" data-bi-name="content" dir="ltr" id="main" lang="en-us" role="main">
<div data-main-column="">
<!-- Article header -->

<!-- Unit navigation menu -->

<!-- Main content area -->
<div class="content"><div class="modular-content-container has-body-background box">
<div class="section is-uniform position-relative" id="unit-inner-section">
<h1 class="margin-right-xxl-desktop" id="module-unit-title">Summary</h1>
<div class="xp-tag position-absolute top-0 right-0 margin-top-xs margin-top-sm-tablet margin-top-lg-desktop margin-top-xs-interactive margin-right-sm margin-right-lg-tablet margin-right-sm-interactive" data-progress-uid="learn.wwl.build-copilot-ai-studio.summary">
<div class="xp-tag-hexagon">
<span class="xp-tag-icon is-shown-complete docon docon-check">
<span class="visually-hidden">Completed</span>
</span>
<span class="xp-tag-xp"></span>
</div>
</div>
<ul class="metadata page-metadata" id="module-unit-metadata">
<li id="module-unit-total-time">1 minute</li>
</ul>
<div aria-hidden="true" hidden="" id="module-unit-module-assessment-message-container"></div>
<div hidden="" id="module-unit-notification-container"></div>
<div id="module-unit-content">
<p>In this module, you learned to:</p>
<ul>
<li>Identify the need to ground your language model with Retrieval Augmented Generation (RAG).</li>
<li>Index your data with Azure AI Search to make it searchable for language models.</li>
<li>Build an agent using RAG on your own data in Microsoft Foundry.</li>
</ul>
<h3 id="learn-more">Learn more</h3>
<ul>
<li><a data-linktype="absolute-path" href="/en-us/azure/ai-foundry/how-to/model-catalog-overview">Model catalog and collections in Microsoft Foundry portal</a></li>
<li><a data-linktype="absolute-path" href="/en-us/azure/ai-foundry/concepts/deployments-overview">Deploy AI models in Microsoft Foundry portal</a></li>
<li><a data-linktype="absolute-path" href="/en-us/azure/ai-services/openai/concepts/prompt-engineering">Prompt engineering techniques</a></li>
<li><a data-linktype="external" href="https://aka.ms/azureaifoundry/discord">Microsoft Foundry Discord</a></li>
<li><a data-linktype="external" href="https://aka.ms/azureaifoundry/forum">Microsoft Foundry Developer Forum</a></li>
</ul>
</div>
<div class="modular-content-container" hidden="" id="next-section">
</div>
</div>
</div>
</div>
<!-- Feedback area -->
<div class="modular-content-container margin-block-xs">
<section class="feedback-section section is-full-height is-uniform padding-block-none position-relative">
<div class="font-weight-semibold display-none" id="ms--unit-support-message"></div>
<div id="ms--unit-user-feedback">
<!-- feedback section -->

<!-- end feedback section -->
</div>
</section>
</div>
<!-- Interactive footer area -->
</div>
</main></div>
    </div>
</body>
</html>